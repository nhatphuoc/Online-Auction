CREATE SCHEMA "public";
CREATE TABLE "bidding_history" (
	"id" bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "bidding_history_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 1 CACHE 1),
	"amount" double precision,
	"bidder_id" bigint,
	"created_at" timestamp,
	"product_id" bigint,
	"reason" varchar(255),
	"request_id" varchar(255),
	"status" varchar(255),
	CONSTRAINT "bidding_history_status_check" CHECK (CHECK (((status)::text = ANY ((ARRAY['SUCCESS'::character varying, 'FAILED'::character varying])::text[]))))
);
CREATE TABLE "categories" (
	"id" bigserial PRIMARY KEY,
	"name" varchar(255) NOT NULL,
	"slug" varchar(255) NOT NULL CONSTRAINT "categories_slug_key" UNIQUE,
	"description" text,
	"parent_id" bigint,
	"level" integer DEFAULT 1 NOT NULL,
	"is_active" boolean DEFAULT true NOT NULL,
	"display_order" integer DEFAULT 0,
	"created_at" timestamp,
	"updated_at" timestamp
);
CREATE TABLE "comments" (
	"id" serial PRIMARY KEY,
	"product_id" integer NOT NULL,
	"sender_id" bigint NOT NULL,
	"content" text NOT NULL,
	"created_at" timestamp DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE "order_messages" (
	"id" bigserial PRIMARY KEY,
	"order_id" bigint NOT NULL,
	"sender_id" bigint NOT NULL,
	"message" text NOT NULL,
	"created_at" timestamp DEFAULT CURRENT_TIMESTAMP
);
CREATE TABLE "order_ratings" (
	"id" bigserial PRIMARY KEY,
	"order_id" bigint NOT NULL CONSTRAINT "order_ratings_order_id_key" UNIQUE,
	"buyer_rating" integer,
	"buyer_comment" text,
	"seller_rating" integer,
	"seller_comment" text,
	"buyer_rated_at" timestamp,
	"seller_rated_at" timestamp,
	"created_at" timestamp DEFAULT CURRENT_TIMESTAMP,
	"updated_at" timestamp DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT "order_ratings_buyer_rating_check" CHECK (CHECK ((buyer_rating = ANY (ARRAY['-1'::integer, 1])))),
	CONSTRAINT "order_ratings_seller_rating_check" CHECK (CHECK ((seller_rating = ANY (ARRAY['-1'::integer, 1]))))
);
CREATE TABLE "orders" (
	"id" bigserial PRIMARY KEY,
	"auction_id" bigint NOT NULL,
	"winner_id" bigint NOT NULL,
	"seller_id" bigint NOT NULL,
	"final_price" double precision NOT NULL,
	"status" varchar(50) NOT NULL,
	"payment_method" varchar(100),
	"payment_proof" text,
	"shipping_address" text,
	"shipping_phone" varchar(20),
	"tracking_number" varchar(100),
	"shipping_invoice" text,
	"paid_at" timestamp,
	"delivered_at" timestamp,
	"completed_at" timestamp,
	"cancelled_at" timestamp,
	"cancel_reason" text,
	"created_at" timestamp DEFAULT CURRENT_TIMESTAMP,
	"updated_at" timestamp DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT "orders_status_check" CHECK (CHECK (((status)::text = ANY ((ARRAY['PENDING_PAYMENT'::character varying, 'PAID'::character varying, 'ADDRESS_PROVIDED'::character varying, 'SHIPPING'::character varying, 'DELIVERED'::character varying, 'COMPLETED'::character varying, 'CANCELLED'::character varying])::text[]))))
);
CREATE TABLE "otp_tokens" (
	"id" bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "otp_tokens_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 1 CACHE 1),
	"email" varchar(255) CONSTRAINT "ukgy16pd6s8as0hxesl21n5e6l2" UNIQUE,
	"expired_at" timestamp,
	"otp_code" varchar(255)
);
CREATE TABLE "product_images" (
	"product_id" bigint NOT NULL,
	"image_url" varchar(255)
);
CREATE TABLE "products" (
	"id" bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "products_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 1 CACHE 1),
	"auto_extend" boolean NOT NULL,
	"buy_now_price" double precision,
	"category_id" bigint,
	"created_at" timestamp,
	"current_price" double precision,
	"description" text,
	"end_at" timestamp,
	"name" varchar(255),
	"seller_id" bigint,
	"starting_price" double precision,
	"step_price" double precision,
	"thumbnail_url" text,
	"current_bidder" bigint,
	"bid_count" bigint,
	"category_name" varchar(255),
	"parent_category_id" bigint,
	"parent_category_name" varchar(255),
	"order_created" boolean NOT NULL,
	"status" varchar(255),
	"sent_email" boolean NOT NULL,
	CONSTRAINT "products_status_check" CHECK (CHECK (((status)::text = ANY ((ARRAY['ACTIVE'::character varying, 'FINISHED'::character varying, 'PENDING'::character varying, 'REJECTED'::character varying])::text[]))))
);
CREATE TABLE "user_upgrade_requests" (
	"id" bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "user_upgrade_requests_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 1 CACHE 1),
	"created_at" timestamp,
	"reason" varchar(255),
	"reviewed_at" timestamp,
	"reviewed_by_admin_id" bigint,
	"status" varchar(255),
	"user_id" bigint NOT NULL,
	"rejection_reason" varchar(255),
	CONSTRAINT "user_upgrade_requests_status_check" CHECK (CHECK (((status)::text = ANY ((ARRAY['PENDING'::character varying, 'APPROVED'::character varying, 'REJECTED'::character varying])::text[]))))
);
CREATE TABLE "users" (
	"id" bigint PRIMARY KEY GENERATED BY DEFAULT AS IDENTITY (sequence name "users_id_seq" INCREMENT BY 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 1 CACHE 1),
	"birth_day" date,
	"email" varchar(255) CONSTRAINT "uk6dotkott2kjsp8vw4d0m25fb7" UNIQUE,
	"email_verified" boolean,
	"full_name" varchar(255),
	"is_seller_request_sent" boolean,
	"password" varchar(255),
	"role" varchar(255),
	"total_number_good_reviews" integer NOT NULL,
	"total_number_reviews" integer NOT NULL,
	CONSTRAINT "users_role_check" CHECK (CHECK (((role)::text = ANY ((ARRAY['ROLE_BIDDER'::character varying, 'ROLE_SELLER'::character varying, 'ROLE_ADMIN'::character varying])::text[]))))
);
CREATE TABLE "watch_list" (
	"id" bigserial PRIMARY KEY,
	"user_id" bigint NOT NULL UNIQUE,
	"product_id" bigint NOT NULL UNIQUE,
	"created_at" timestamp DEFAULT CURRENT_TIMESTAMP,
	CONSTRAINT "watch_list_unique_user_product" UNIQUE("user_id","product_id")
);
ALTER TABLE "categories" ADD CONSTRAINT "categories_parent_id_fkey" FOREIGN KEY ("parent_id") REFERENCES "categories"("id") ON DELETE SET NULL;
ALTER TABLE "comments" ADD CONSTRAINT "comments_product_id_fkey" FOREIGN KEY ("product_id") REFERENCES "products"("id") ON DELETE CASCADE;
ALTER TABLE "order_messages" ADD CONSTRAINT "order_messages_order_id_fkey" FOREIGN KEY ("order_id") REFERENCES "orders"("id") ON DELETE CASCADE;
ALTER TABLE "order_ratings" ADD CONSTRAINT "order_ratings_order_id_fkey" FOREIGN KEY ("order_id") REFERENCES "orders"("id") ON DELETE CASCADE;
ALTER TABLE "product_images" ADD CONSTRAINT "fkqnq71xsohugpqwf3c9gxmsuy" FOREIGN KEY ("product_id") REFERENCES "products"("id");
ALTER TABLE "user_upgrade_requests" ADD CONSTRAINT "fkp46kv02kba6nf8hj15p7ilj31" FOREIGN KEY ("user_id") REFERENCES "users"("id");
CREATE UNIQUE INDEX "bidding_history_pkey" ON "bidding_history" ("id");
CREATE UNIQUE INDEX "categories_pkey" ON "categories" ("id");
CREATE UNIQUE INDEX "categories_slug_key" ON "categories" ("slug");
CREATE INDEX "idx_categories_level" ON "categories" ("level");
CREATE INDEX "idx_categories_parent_id" ON "categories" ("parent_id");
CREATE UNIQUE INDEX "comments_pkey" ON "comments" ("id");
CREATE INDEX "idx_comments_created_at" ON "comments" ("created_at");
CREATE INDEX "idx_comments_product" ON "comments" ("product_id");
CREATE INDEX "idx_comments_sender" ON "comments" ("sender_id");
CREATE INDEX "idx_order_messages_order_id" ON "order_messages" ("order_id");
CREATE UNIQUE INDEX "order_messages_pkey" ON "order_messages" ("id");
CREATE INDEX "idx_order_ratings_order_id" ON "order_ratings" ("order_id");
CREATE UNIQUE INDEX "order_ratings_order_id_key" ON "order_ratings" ("order_id");
CREATE UNIQUE INDEX "order_ratings_pkey" ON "order_ratings" ("id");
CREATE INDEX "idx_orders_auction_id" ON "orders" ("auction_id");
CREATE INDEX "idx_orders_seller_id" ON "orders" ("seller_id");
CREATE INDEX "idx_orders_status" ON "orders" ("status");
CREATE INDEX "idx_orders_winner_id" ON "orders" ("winner_id");
CREATE UNIQUE INDEX "orders_pkey" ON "orders" ("id");
CREATE UNIQUE INDEX "otp_tokens_pkey" ON "otp_tokens" ("id");
CREATE UNIQUE INDEX "ukgy16pd6s8as0hxesl21n5e6l2" ON "otp_tokens" ("email");
CREATE INDEX "idx_product_images_product_id" ON "product_images" ("product_id");
CREATE INDEX "idx_products_category_id" ON "products" ("category_id");
CREATE INDEX "idx_products_status" ON "products" ("status");
CREATE UNIQUE INDEX "products_pkey" ON "products" ("id");
CREATE UNIQUE INDEX "user_upgrade_requests_pkey" ON "user_upgrade_requests" ("id");
CREATE UNIQUE INDEX "uk6dotkott2kjsp8vw4d0m25fb7" ON "users" ("email");
CREATE UNIQUE INDEX "users_pkey" ON "users" ("id");
CREATE INDEX "idx_watch_list_product_id" ON "watch_list" ("product_id");
CREATE INDEX "idx_watch_list_user_id" ON "watch_list" ("user_id");
CREATE UNIQUE INDEX "watch_list_pkey" ON "watch_list" ("id");
CREATE UNIQUE INDEX "watch_list_unique_user_product" ON "watch_list" ("user_id","product_id");